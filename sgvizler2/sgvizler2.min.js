!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jquery")):"function"==typeof define&&define.amd?define(["exports","jquery"],t):t(e.sgvizler2={},e.jQuery)}(this,function(e,t){"use strict";function a(e,t,a,i){return new(a||(a=Promise))(function(s,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?s(e.value):new a(function(t){t(e.value)}).then(r,o)}l((i=i.apply(e,t||[])).next())})}function i(){P.loadAllDependencies()}function s(e){e&&"object"==typeof e&&(J.API.key=e.googleApiKey?e.googleApiKey:"",te.API.osmAccessToken=e.osmAccessToken?e.osmAccessToken:"",O.path=e.path?e.path:"")}function n(e,t){s(t),P.drawWithElementId(e)}function r(e){s(e),P.drawAll()}function o(e){b.drawWithElementId(e)}function l(){b.drawAll()}function d(e,t){return b.getChartDoc(e,t)}function c(e,t,a,i,s,n,r,o,l){return P.create(e,t,a,i,s,n,r,o,l)}var u;t.default;!function(e){e[e.EMPTY=0]="EMPTY",e[e.UNKNOWN=1]="UNKNOWN",e[e.VARIABLE=2]="VARIABLE",e[e.STYLE=3]="STYLE",e[e.CLASS=4]="CLASS",e[e.WIKI=5]="WIKI"}(u||(u={}));class h{constructor(){this.options={},this._tabDependences=[],this._patternOptions=u.EMPTY,this._width="",this._height="",this._optionsRaw="",this._class="",this._style="",this._width="100%",this._isDone=!1;let e=this;T.on("loaded",()=>{null!=e.container&&!e._isDone&&e.isLoadedAllDependencies()&&null!==e._resultSparql&&e.doDraw()})}loadDependenciesAndDraw(e){return a(this,void 0,void 0,function*(){v.log(this.container,"Chart loaded dependencies : "+this.container.id),this._resultSparql=e,this.isLoadedAllDependencies()?yield this.doDraw():yield this.loadDependencies()})}loadDependencies(){return a(this,void 0,void 0,function*(){let e=[];for(let t of this._tabDependences)e.push(t.load());return Promise.all(e)})}get patternOptions(){return this._patternOptions}get classHtml(){return this._class}set classHtml(e){this._class=e}get style(){return this._style}set style(e){this._style=e}get container(){return this._container}set container(e){this._container=e}get optionsRaw(){return this._optionsRaw}set optionsRaw(e){this._optionsRaw=e,this.doParseOptionsRaw()}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}getHTMLStyleOrClass(){let e="",t=this.options;return this._patternOptions===u.CLASS&&(e='class="'+(e=Object.keys(t).map(e=>"${opts[property]}").join(" "))+'"'),this._patternOptions===u.STYLE&&(e='style="'+(e=Object.keys(t).map(e=>"${property}:${opts[property]}").join(";"))+'"'),e}addScript(e,t){let a=new m(e,t);return this._tabDependences.push(a),a}addCss(e,t){let a=new E(e,t);return this._tabDependences.push(a),a}isLoadedAllDependencies(){for(let e of this._tabDependences)if(!T.isLoaded(e))return!1;return!0}doDraw(){v.log(this.container,"Chart started : "+this._container.id);let e=this;null!==e._resultSparql?e.draw(e._resultSparql).then(function(t){e._isDone=!0,v.log(e.container,"Chart finished : "+e._container.id)},function(t){console.log(t),v.displayFeedback(e._container,R.ERROR_CHART,[t]),v.log(e.container,"Chart finished with error : "+e._container.id)}):(v.displayFeedback(e._container,R.ERROR_DATA_EMPTY),v.log(e.container,"Chart finished with error : "+e._container.id))}execPattern(e,t){let a,i=this._optionsRaw;for(;null!==(a=e.exec(i));)this.options[a[1]]=a[2].trim(),this._patternOptions=t}doParseOptionsRaw(){let e=/\|? *([^=]*) *= *([^=|]*)/iy,t=/([^:]+):([^:;]+) *;?/iy,a=/([^ |;]+) ?/iy,i=/\!? *([^=]*) *= *([^=!]*)/iy,s=this._optionsRaw;if(this._patternOptions=""===s?u.EMPTY:u.UNKNOWN,-1===this._optionsRaw.indexOf("|")&&this.patternOptions===u.UNKNOWN&&this.execPattern(i,u.WIKI),this.patternOptions===u.UNKNOWN&&this.execPattern(e,u.VARIABLE),this.patternOptions===u.UNKNOWN&&this.execPattern(t,u.STYLE),this.patternOptions===u.UNKNOWN){let e,t=this._optionsRaw,i=0;for(;null!==(e=a.exec(t));)this.options["class"+i]=e[2],this._patternOptions=u.UNKNOWN,i++}this.patternOptions===u.UNKNOWN?v.displayFeedback(this.container,R.ERROR_CHART_PATTERN_OPTION_UNKNOWN,[this._optionsRaw]):this.patternOptions!==u.WIKI&&this.patternOptions!==u.VARIABLE&&this.patternOptions!==u.STYLE||(void 0!==this.options.width&&(this.width=this.options.width),void 0!==this.options.height&&(this.height=this.options.height))}}class p extends h{get icon(){return"fa-table"}get label(){return"Table"}get subtext(){return"simple table"}get classFullName(){return"sgvizler.visualization.Table"}get tutorialFilename(){return"tutorial-sgvizler_visualization_Table.html"}constructor(){super()}draw(e){let t=this;return new Promise(function(a,i){let s=Object.assign({headings:"true"},t.options),n=e.head.vars,r=e.results.bindings,o=(n.length,r.length,"<table "+t.getHTMLStyleOrClass()+" >");if("true"===s.headings){o+="<tr>";for(let e of n)o+="<th>"+e+"</th>";o+="</tr>"}for(let e of r){o+="<tr>";for(let t of n)o+="<td>"+e[t].value+"</td>";o+="</tr>"}o+="</table>";let l=document.getElementById(t.container.id);l&&(l.innerHTML=o),a()})}}var g=Object.freeze({Table:p});class T{static on(e,t){"loaded"===e&&T._listCallEvent.push(t)}static detectRoot(){let e=document.evaluate('//script[contains(@src,"sgvizler2.js")]/@src',document,null,XPathResult.STRING_TYPE,null).stringValue,t=/^(.*)sgvizler2\.js$/.exec(e);t&&(T._pathScripts=t[1])}static isLoad(e){return-1!==T._load.indexOf(e.url)}static isLoaded(e){return-1!==T._loaded.indexOf(e.url)}static load(e){e instanceof m?T.loadScript(e):e instanceof E&&T.loadCss(e)}static fireEvent(e){for(let t of T._listCallEvent)t(e)}static checkDependenciesToLoad(){let e=T._dependenciesToLoad.length;for(let t=0;t<e;t++){let e=T._dependenciesToLoad[t];void 0===e||T.isLoaded(e)?this._dependenciesToLoad.splice(t):e instanceof m?T.loadScript(e):e instanceof m&&T.loadCss(e)}}static getAbsoluteURL(e){return e.match(/^(\/\/|https?)/)?e:T._pathScripts+e}static loadScript(e){let t=e.url;return new Promise(function(a,i){if(e.loadBefore&&!e.loadBefore.endDownload)return T._dependenciesToLoad.push(e),T.load(e.loadBefore),a();if(T.isLoad(e))return a();T._load.push(t),v.logSimple("Loading : "+e.url);let s=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=T.getAbsoluteURL(t),n.onload=function(){T._loaded.push(t),e.callBack(),T.checkDependenciesToLoad(),T.fireEvent("loaded")},s.appendChild(n)})}static loadCss(e){let t=e.url;return new Promise(function(a,i){if(e.loadBefore&&!e.loadBefore.endDownload)return T._dependenciesToLoad.push(e),T.load(e.loadBefore);if(T.isLoad(e))return;T._load.push(t);let s=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.href=T.getAbsoluteURL(t),n.onload=function(){T._loaded.push(t),v.logSimple("Loaded : "+t),e.callBack(),T.checkDependenciesToLoad(),T.fireEvent("loaded")},s.appendChild(n)})}}T._load=[],T._loaded=[],T._dependenciesToLoad=[],T._pathScripts="",T._listCallEvent=[];class _{constructor(e,t){this.url=e,this.loadBefore=t||null,this.endDownload=!1,this.startDownload=!1}load(){this.isLoaded()||(this.startDownload=!0,v.logSimple("Load started :"+this.url),T.load(this))}isLoaded(){return T.isLoaded(this)&&(this.startDownload=!0,this.endDownload=!0),this.endDownload}callBack(){this.endDownload=!0,v.logSimple("Load ended :"+this.url)}}class m extends _{}class E extends _{}class f{static getErrorMessage(e){let t=/MalformedQueryException: *(.*)/m.exec(e.response);return null!==t?t[1]:e.response}}class b{static drawWithElementId(e){return a(this,void 0,void 0,function*(){let t=document.getElementById(e);t&&(yield b.draw(t))})}static draw(e,t){return a(this,void 0,void 0,function*(){let a=b.getSelectOptions(t);for(let t of a)e.appendChild(t.cloneNode(!0))})}static drawAll(){let e=b.getSelectOptions(),t=document.evaluate("//select[contains(@class, '"+b.CLASS_NAME+"')]",document,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(let a=0;a<t.snapshotLength;a++)for(let i of e)t.snapshotItem(a).appendChild(i.cloneNode(!0))}static getChartDoc(e,t){let a=w.getObjectByPath(e),i="";return(i=void 0!==t?t:O.DOCPATH)+a.tutorialFilename}static getSelectOptions(e){let t,a,i,s,n,r,o,l,d=[],c=e&&e.selected?e.selected:this.classOfChartSelectedByDefault;for(let u of this.charts){i=document.createElement("optgroup"),(s=document.createAttribute("label")).value=u.label,i.setAttributeNode(s);for(let s of u.charts)t=w.getObjectByPath(s),a=document.createElement("option"),(r=document.createAttribute("data-icon")).value=t.icon,o=document.createAttribute("data-subtext"),"classFullName"===e.subtext?o.value=t.classFullName:o.value=t.subtext,(n=document.createAttribute("value")).value=t.classFullName,c===s&&(l=document.createAttribute("selected"),a.setAttributeNode(l)),a.text=t.label,a.setAttributeNode(r),a.setAttributeNode(o),a.setAttributeNode(n),i.appendChild(a);d.push(i)}return d}}b.CLASS_NAME="sgvizler-select",b.classOfChartSelectedByDefault="bordercloud.visualization.DataTable",b.charts=[{label:"bordercloud.visualization",charts:["bordercloud.visualization.DataTable"]},{label:"d3.visualization",charts:["d3.visualization.Pie"]},{label:"leaflet.visualization",charts:["leaflet.visualization.Map"]},{label:"google.visualization",charts:["google.visualization.Table","google.visualization.Map"]},{label:"sgvizler.visualization",charts:["sgvizler.visualization.Table"]}];var R;!function(e){e[e.ERROR_CHART_UNKNOWN=0]="ERROR_CHART_UNKNOWN",e[e.ERROR_CHART_PATTERN_OPTION_UNKNOWN=1]="ERROR_CHART_PATTERN_OPTION_UNKNOWN",e[e.ERROR_REQUEST=2]="ERROR_REQUEST",e[e.ERROR_CHART=3]="ERROR_CHART",e[e.ERROR_DEPENDENCIES=4]="ERROR_DEPENDENCIES",e[e.ERROR_ENDPOINT_FORGOT=5]="ERROR_ENDPOINT_FORGOT",e[e.ERROR_DATA_EMPTY=6]="ERROR_DATA_EMPTY"}(R||(R={}));class A{static get(e,t){let a="";switch(e){case R.ERROR_CHART_UNKNOWN:a="The chart $0 does not exist.";break;case R.ERROR_CHART_PATTERN_OPTION_UNKNOWN:a="The pattern of chart options is unknown : '$0'Use 'variable1=value1|variable1=value1' or for style 'width:100%;font:red;' or 'class1 class2'";break;case R.ERROR_REQUEST:a="Sorry, the sparql server sent an error. </br> $0";break;case R.ERROR_CHART:a="Sorry, the chart sent an error. </br> $0";break;case R.ERROR_DEPENDENCIES:a="The chart dependencies sent an error. </br> $0";break;case R.ERROR_ENDPOINT_FORGOT:a="The endpoint of Sparql service is forgotten (data-sgvizler-endpoint).";break;case R.ERROR_DATA_EMPTY:a="The resquest sent null."}if(t)for(let e=0,i=t.length;e<i;e++)a=a.replace("$"+e,t[e]);return a}}class w{static getObjectByPath(e,t){let a,i,s=e.split("."),n=t||se;for(a=0,i=s.length;a<i&&void 0!==n;a+=1)if(a<i-1)n=n[s[a]];else try{n=new n[s[a]]}catch(e){n=void 0}return void 0!==n||t||(n=this.getObjectByPath(e,window)),n}static encodeHtml(e){let t=[];for(let a=e.length-1;a>=0;a--)t.unshift(["&#",e.charCodeAt(a),";"].join(""));return t.join("")}static decodeHtml(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t).replace(/\s/g,function(e,t){return" "})})}}class v{static log(e,t){2===e.loglevel&&console.log(this.elapsedTime()+"s: "+t)}static logSimple(e){console.log(this.elapsedTime()+"s: "+e)}static displayFeedback(e,t,a){let i=A.get(t,a);if(2===e.loglevel&&i){let t=document.getElementById(e.id);t&&(t.innerHTML="<p style='color:red'>"+i+"</p>")}}static elapsedTime(){return(Date.now()-this._startTime)/1e3}}v._startTime=Date.now();class O{static get path(){return this._path}static set path(e){this._path=e}}O.VERSION="0.0",O.HOMEPAGE="https://bordercloud.github.io/sgvizler2/index.html",O.DOCPATH="https://bordercloud.github.io/sgvizler2/",O._path="";var N;!function(e){e[e.xml=0]="xml",e[e.json=1]="json",e[e.jsonp=2]="jsonp"}(N||(N={}));class D{static getOutputLabel(e){let t="";switch(e){case N.xml:t="xml";break;case N.json:t="json";break;case N.jsonp:t="jsonp"}return t}static getXMLHttpRequestResponseType(e){let t="";switch(e){case N.xml:t="";break;case N.json:case N.jsonp:t="json"}return t}static getHeaderAccept(e){let t="";switch(e){case N.xml:t="application/sparql-results+xml";break;case N.json:case N.jsonp:t="application/sparql-results+json"}return t}static convertString(e){let t=N.json;switch(e){case"xml":t=N.xml;break;case"json":t=N.json;break;case"jsonp":t=N.jsonp}return t}}class y{constructor(){this._query="",this._endpoint="",this._endpointOutputFormat=N.json,this._method="GET",this._queryParameter="query",this.listeners={}}get method(){return this._method}set method(e){this._method=e}get container(){return this._container}set container(e){this._container=e}get query(){return this._query}set query(e){this._query=e}get endpoint(){return this._endpoint}set endpoint(e){this._endpoint=e}get endpointOutputFormat(){return this._endpointOutputFormat}set endpointOutputFormat(e){this._endpointOutputFormat=e}get queryParameter(){return this._queryParameter}set queryParameter(e){this._queryParameter=e}sendRequest(){let e=this;return new Promise(function(t,a){let i,s=new XMLHttpRequest,n=e.endpoint;"get"===e.method.toLowerCase()?n+="?"+e.queryParameter+"="+encodeURIComponent(e.query)+"&output="+D.getOutputLabel(e.endpointOutputFormat):i=e.queryParameter+"="+encodeURIComponent(e.query),s.open(e.method,n,!0),s.setRequestHeader("Accept",D.getHeaderAccept(e.endpointOutputFormat)),s.onprogress=function(e){if(e.lengthComputable){let t=e.loaded/e.total*100;console.log("onprogress"+t)}},s.onload=function(e){s.readyState===XMLHttpRequest.DONE&&(200===s.status?t(JSON.parse(s.response)):a(f.getErrorMessage(s)))},s.onerror=function(e){a(f.getErrorMessage(s))},s.onabort=function(){a(f.getErrorMessage(s))},i?(s.setRequestHeader("content-type","application/x-www-form-urlencoded"),s.send(i)):s.send()})}}var I;!function(e){e[e.FAILED=0]="FAILED",e[e.LOADED=1]="LOADED",e[e.LOADING=2]="LOADING"}(I||(I={}));class P{constructor(e){this._chartOptions="",this._chartName="",this._loglevel=0,this._id="";let t=document.getElementById(e);if(null===t)throw new Error("elementID unknown : "+e);let a=P;this._state=I.LOADING;let i=t.attributes;i[a.LOG_LEVEL_ATTRIBUTE_NAME]&&(this._loglevel=parseInt(i[a.LOG_LEVEL_ATTRIBUTE_NAME].value,10)),i[a.CHART_ATTRIBUTE_NAME]&&(this._chartName=i[a.CHART_ATTRIBUTE_NAME].value),i[a.CHART_OPTION_ATTRIBUTE_NAME]&&(this._chartOptions=w.decodeHtml(i[a.CHART_OPTION_ATTRIBUTE_NAME].value));let s=new y;if(s.container=this,this._id=e,i[a.QUERY_ATTRIBUTE_NAME]&&(s.query=w.decodeHtml(i[a.QUERY_ATTRIBUTE_NAME].value)),!i[a.ENDPOINT_ATTRIBUTE_NAME])return this._state=I.FAILED,void v.displayFeedback(this,R.ERROR_ENDPOINT_FORGOT);s.endpoint=w.decodeHtml(i[a.ENDPOINT_ATTRIBUTE_NAME].value),i[a.OUTPUT_FORMAT_ATTRIBUTE_NAME]&&(s.endpointOutputFormat=D.convertString(i[a.OUTPUT_FORMAT_ATTRIBUTE_NAME].value)),i[a.OUTPUT_METHOD_ATTRIBUTE_NAME]&&(s.method=i[a.OUTPUT_METHOD_ATTRIBUTE_NAME].value),i[a.QUERY_PARAMETER_ATTRIBUTE_NAME]&&(s.queryParameter=i[a.QUERY_PARAMETER_ATTRIBUTE_NAME].value),this._request=s;let n=w.getObjectByPath(this.chartName);if(void 0===n)this._state=I.FAILED,v.displayFeedback(this,R.ERROR_CHART_UNKNOWN,[this.chartName]);else{n.container=this;try{let t=$("#"+e),a=t.css("width"),i=t.css("height");null!==a&&(n.width=a),null!==i&&"0px"!==i&&(n.height=i)}catch(e){}n.optionsRaw=this._chartOptions,this._chart=n}}static drawWithElementId(e,t){return a(this,void 0,void 0,function*(){let t=new P(e);v.log(t,"drawing id: "+e),yield t.draw()})}static drawAll(){let e=[],t=[],a=document.evaluate("//div[@"+P.PREFIX+"query]/@id",document,null,XPathResult.ANY_TYPE,null),i=a.iterateNext();for(;i;)t.push(i.value),i=a.iterateNext();for(let a of t)e.push(P.drawWithElementId(a));return Promise.all(e)}static loadDependenciesId(e,t){return a(this,void 0,void 0,function*(){let t=new P(e);v.log(t,"Load dependencies id: "+e),yield t.loadDependencies()})}static loadAllDependencies(){let e=[],t=[],a=document.evaluate("//div[@"+P.PREFIX+"query]/@id",document,null,XPathResult.ANY_TYPE,null),i=a.iterateNext();for(;i;)t.push(i.value),i=a.iterateNext();for(let a of t)e.push(P.loadDependenciesId(a));return Promise.all(e)}static create(e,t,a,i,s,n,r,o,l){let d=document.getElementById(e);if(null===d)throw new Error("elementID unknown : "+e);let c=P,u=document.createAttribute(c.QUERY_ATTRIBUTE_NAME),h=document.createAttribute(c.ENDPOINT_ATTRIBUTE_NAME),p=document.createAttribute(c.CHART_ATTRIBUTE_NAME);if(u.value=a,h.value=t,p.value=i,d.setAttributeNode(u),d.setAttributeNode(h),d.setAttributeNode(p),s){let e=document.createAttribute(c.CHART_OPTION_ATTRIBUTE_NAME);e.value=s,d.setAttributeNode(e)}if(n){let e=document.createAttribute(c.LOG_LEVEL_ATTRIBUTE_NAME);e.value=n,d.setAttributeNode(e)}if(r){let e=document.createAttribute(c.OUTPUT_FORMAT_ATTRIBUTE_NAME);e.value=r,d.setAttributeNode(e)}if(o){let e=document.createAttribute(c.OUTPUT_METHOD_ATTRIBUTE_NAME);e.value=o,d.setAttributeNode(e)}if(l){let e=document.createAttribute(c.QUERY_PARAMETER_ATTRIBUTE_NAME);e.value=l,d.setAttributeNode(e)}return d.innerHTML}get id(){return this._id}get chartName(){return this._chartName}get chartOptions(){return this._chartOptions}get chart(){return this._chart}get request(){return this._request}get loglevel(){return this._loglevel}draw(){return a(this,void 0,void 0,function*(){let e;if(this._state!==I.FAILED){try{e=yield this.request.sendRequest()}catch(e){console.log(e),v.displayFeedback(this,R.ERROR_REQUEST,[e]),this._state=I.FAILED}if(this._state!==I.FAILED)try{this._chart.loadDependenciesAndDraw(e)}catch(e){console.log(e),v.displayFeedback(this,R.ERROR_CHART,[e]),this._state=I.FAILED}}})}loadDependencies(){return a(this,void 0,void 0,function*(){try{yield this._chart.loadDependencies()}catch(e){console.log(e),v.displayFeedback(this,R.ERROR_DEPENDENCIES,[e]),this._state=I.FAILED}})}}P.PREFIX="data-sgvizler-",P.QUERY_ATTRIBUTE_NAME=P.PREFIX+"query",P.ENDPOINT_ATTRIBUTE_NAME=P.PREFIX+"endpoint",P.OUTPUT_FORMAT_ATTRIBUTE_NAME=P.PREFIX+"endpoint-output-format",P.QUERY_PARAMETER_ATTRIBUTE_NAME=P.PREFIX+"endpoint-query-parameter",P.OUTPUT_METHOD_ATTRIBUTE_NAME=P.PREFIX+"endpoint-method",P.CHART_ATTRIBUTE_NAME=P.PREFIX+"chart",P.CHART_OPTION_ATTRIBUTE_NAME=P.PREFIX+"chart-options",P.LOG_LEVEL_ATTRIBUTE_NAME=P.PREFIX+"log";const C=g;var M,S=Object.freeze({visualization:C,Loader:T,Dependency:_,ScriptDependency:m,CssDependency:E,SparqlError:f,Select:b,get MESSAGES(){return R},Messages:A,Tools:w,Logger:v,Core:O,get CHART_PATTERN_OPTIONS(){return u},Chart:h,get SPARQL_RESULT(){return N},SparqlTools:D,Request:y,get CONTAINER_STATE(){return I},Container:P});!function(e){e[e.TAG=0]="TAG",e[e.STYLE=1]="STYLE"}(M||(M={}));class U extends h{constructor(){super(),this.addCss(O.path+"/lib/DataTables/datatables.min.css"),this.addCss(O.path+"/lib/DataTables/DataTables-1.10.15/css/dataTables.bootstrap4.min.css");let e=this.addScript(O.path+"/lib/DataTables/datatables.min.js");this.addScript(O.path+"/lib/DataTables/DataTables-1.10.15/js/dataTables.bootstrap4.js",e),this.addScript(O.path+"/lib/DataTables/Buttons-1.4.0/js/dataTables.buttons.js",e)}static buildColumnDefs(e,t){let a,i,s,n=/ *col([1-9]+)\_([a-zA-Z]+)\_([^=;\n]*) */gi,r=[],o=[];for(let e=0;e<t;e++)o[e]=[],o[e][M.TAG]="",o[e][M.STYLE]="";for(;null!==(a=n.exec(e));)a.index===n.lastIndex&&n.lastIndex++,o[s=parseInt(a[1],10)-1][M.TAG]=a[2],o[s][M.STYLE]+=a[3]+";";for(let e=0;e<t;e++){switch(o[e][M.TAG]){case"img":i=this.getFunctionColumnDefImg(o[e][M.STYLE]);break;case"span":i=this.getFunctionColumnDefSpan(o[e][M.STYLE]);break;default:i=this.getFunctionColumnDefDefault()}r[e]={targets:e,render:i}}return r}static getFunctionColumnDefDefault(){return function(e,t,a,i){return e}}static getFunctionColumnDefImg(e){return function(t,a,i,s){return'<img src="'+t+'"  style="'+e+'">'}}static getFunctionColumnDefSpan(e){return function(t,a,i,s){return'<span style="'+e+'">'+t+"</span>"}}get icon(){return"fa-table"}get label(){return"DataTable"}get subtext(){return"DataTable"}get classFullName(){return"bordercloud.visualization.DataTable"}get tutorialFilename(){return"tutorial-bordercloud_visualization_DataTable.html"}draw(e){let t=this;return new Promise(function(a,i){let s=document.getElementById(t.container.id);if(!s)return v.displayFeedback(t.container,R.ERROR_CHART_UNKNOWN,[t.container.id]),a();try{let a,n,r,o=e.head.vars,l=e.results.bindings,d=o.length,c=l.length,u=t.container.id+"-datatable",h=[],p=[],g=document.createElement("table"),T=document.createAttribute("id"),_=document.createAttribute("class"),m=document.createAttribute("cellspacing"),E=document.createAttribute("width"),f=Object.assign({class:"table table-striped table-bordered",cellspacing:"0",width:"100%",colstyle:void 0},t.options);for(let e=0;e<d;e++)h[e]={title:o[e]};void 0!==f.colstyle&&(r=U.buildColumnDefs(f.colstyle,d));for(let e=0;e<c;e++){a=l[e],n=[];for(let e=0;e<d;e+=1)n[e]=void 0!==a[o[e]]?a[o[e]].value:"";p[e]=n}T.value=u,_.value=f.class,m.value=f.cellspacing,E.value=f.width,g.setAttributeNode(T),g.setAttributeNode(_),g.setAttributeNode(m),g.setAttributeNode(E),s.appendChild(g),$("#"+u).DataTable({data:p,columns:h,columnDefs:r,dom:"Bfrtip",buttons:["csv","pdf","print"]})}catch(e){return i(e)}return a()})}}const F=Object.freeze({DataTable:U});var x=Object.freeze({visualization:F});class k{constructor(e){let t=new google.visualization.DataTable,a=e.head.vars,i=e.results.bindings,s=a.length,n=i.length;for(let e of a)if(n>0){let a=i[0][e].datatype;"http://www.w3.org/2001/XMLSchema#decimal"===a||"http://www.w3.org/2001/XMLSchema#integer"===a?t.addColumn("number",e):"http://www.w3.org/2001/XMLSchema#boolean"===a?t.addColumn("boolean",e):"http://www.w3.org/2001/XMLSchema#date"===a?t.addColumn("date",e):"http://www.w3.org/2001/XMLSchema#dateTime"===a?t.addColumn("datetime",e):"http://www.w3.org/2001/XMLSchema#time"===a?t.addColumn("timeofday",e):t.addColumn("string",e)}else t.addColumn("string",e);t.addRows(n);for(let e=0;e<n;e++)for(let n=0;n<s;n++){t.setCell(e,n,i[e][a[n]].value);let s=i[0][a[n]].datatype;if("http://www.w3.org/2001/XMLSchema#decimal"===s)t.setCell(e,n,parseFloat(i[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#integer"===s)t.setCell(e,n,parseInt(i[e][a[n]].value,10));else if("http://www.w3.org/2001/XMLSchema#boolean"===s)t.setCell(e,n,"true"===i[e][a[n]].value);else if("http://www.w3.org/2001/XMLSchema#date"===s)t.setCell(e,n,Date.parse(i[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#dateTime"===s)t.setCell(e,n,Date.parse(i[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#time"===s){let s=Date.parse(i[e][a[n]].value);t.setCell(e,n,[s.getHours(),s.getHours(),s.getSeconds(),s.getMilliseconds()])}else t.setCell(e,n,i[e][a[n]].value)}this._dataTable=t}getDataTable(){return this._dataTable}}class j extends h{constructor(){super();this.addScript("https://www.gstatic.com/charts/loader.js")}static init(){google.charts.load("current",{packages:["table"]}),j._isInit=!0}get icon(){return"fa-table"}get label(){return"Table"}get subtext(){return"Table"}get classFullName(){return"google.visualization.Table"}get tutorialFilename(){return"tutorial-google_visualization_Table.html"}draw(e){let t=this;return new Promise(function(a,i){let s="100%";""!==t.height&&(s=t.height);Object.assign({showRowNumber:!1,width:t.width,height:s},t.options);return j._isInit||j.init(),google.charts.setOnLoadCallback(()=>{let a=new k(e);new google.visualization.Table(document.getElementById(t.container.id)).draw(a.getDataTable(),t.options)}),a()})}}j._isInit=!1;class B{static get key(){return this._key}static set key(e){this._key=e}}B._key="";class z extends h{constructor(){super();this.addScript("https://www.gstatic.com/charts/loader.js")}static init(){google.charts.load("current",{packages:["map"],mapsApiKey:B.key}),z._isInit=!0}get icon(){return"fa-map"}get label(){return"Map"}get subtext(){return"Map"}get classFullName(){return"google.visualization.Map"}get tutorialFilename(){return"tutorial-google_visualization_Map.html"}draw(e){let t=this;return new Promise(function(a,i){let s="100%";""!==t.height&&(s=t.height);let n=Object.assign({width:t.width,height:s,showTooltip:!0,showInfoWindow:!0},t.options);return location.origin.startsWith("file:")&&(n=Object.assign({icons:{default:{normal:"https://maps.google.com/mapfiles/ms/micons/red-dot.png",selected:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"}}},n)),z._isInit||z.init(),google.charts.setOnLoadCallback(()=>{let a=new k(e);new google.visualization.Map(document.getElementById(t.container.id)).draw(a.getDataTable(),n)}),a()})}}z._isInit=!1;const H=Object.freeze({Data:k,Table:j,Map:z});var q=Object.freeze({visualization:H,API:B});class W extends h{get icon(){return"fa-pie-chart"}get label(){return"Pie"}get subtext(){return"Pie"}get classFullName(){return"d3.visualization.Pie"}get tutorialFilename(){return"tutorial-d3_visualization_Pie.html"}constructor(){super(),this.addCss(O.path+"/lib/d3/d3.css");this.addScript(O.path+"/lib/d3/d3.js")}draw(e){let t=this;return new Promise(function(a,i){let s="100%";""!==t.height&&(s=t.height);Object.assign({showRowNumber:!1,width:t.width,height:s},t.options);let n,r,o=e.head.vars,l=e.results.bindings,d=(o.length,l.length,[]);for(let e of l)n=e[o[0]].value,r=Number(e[o[1]].value),void 0===n||void 0===r?v.logSimple("Erreur ? D3JS:pie label "+n+" count "+r):d.push({label:n,count:r});let c=d3.select("#"+t.container.id),u=c.node();if(u){let e=0!==u.clientWidth?u.clientWidth:300,t=0!==u.clientHeight?u.clientHeight:150,a=c.append("svg").attr("width",e).attr("height",t).attr("id","idtest"),i=Math.min(e,t)/2;a=a.append("g").attr("transform","translate("+e/2+","+t/2+")");let s=d3.scaleOrdinal(d3.schemeCategory10),n=d3.arc().innerRadius(0).outerRadius(i),r=d3.pie().value(function(e){return e.count}).sort(null),o=(a.selectAll("path").data(r(d)).enter().append("path").attr("d",n).attr("fill",function(e,t){return s(e.data.label)}),a.selectAll(".legend").data(s.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){let a=22*s.domain().length/2;return"translate("+(2*i-36+20)+","+(22*t-a)+")"}));o.append("rect").attr("width",18).attr("height",18).style("fill",s).style("stroke",s),o.append("text").attr("x",22).attr("y",14).text(function(e){return e})}return a()})}}const Y=Object.freeze({Pie:W});var X=Object.freeze({visualization:Y});class G{static get osmAccessToken(){return this._osmAccessToken}static set osmAccessToken(e){this._osmAccessToken=e}}G._osmAccessToken="";class K extends h{get icon(){return"fa-map"}get label(){return"Map"}get subtext(){return"Map"}get classFullName(){return"leaflet.visualization.Map"}get tutorialFilename(){return"tutorial-leaflet_visualization_Map.html"}constructor(){super(),this.addCss(O.path+"/lib/leaflet/leaflet.css"),this.addCss(O.path+"/lib/leaflet/MarkerCluster.Default.css");let e=this.addScript(O.path+"/lib/leaflet/leaflet-src.js");this.addScript(O.path+"/lib/leaflet/leaflet.markercluster-src.js",e)}draw(e){let t=this;return new Promise(function(a,i){let s,n,r,o,l,d,c="",u=e.head.vars,h=e.results.bindings,p=u.length,g=(h.length,"180px"),T=t.container.id+"-leaflet",_=document.getElementById(t.container.id),m=[];""!==t.height&&(g=t.height);let E=Object.assign({width:t.width,height:g,showTooltip:!0,showInfoWindow:!0},t.options);if(_){_.innerHTML="<div id='"+T+"' style='width: "+E.width+"; height: "+E.height+";'></div>";let e=new L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:G.osmAccessToken});if(s=L.map(T,{zoom:13,layers:[e]}),r=L.markerClusterGroup({chunkedLoading:!0,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0}),p<=2)c="Parameters : latitude(xsd:Decimal) longitude(xsd:Decimal) title(xsd:string optional) introduction(xsd:string optional) link(IRI optional)";else for(let e of h){if(l=parseFloat(e[u[0]].value),d=parseFloat(e[u[1]].value),isNaN(l)||isNaN(d)){c="Latitude or longitude is not a decimal. Parameters of chart : latitude(xsd:Decimal) longitude(xsd:Decimal) title(xsd:string optional) introduction(xsd:string optional) link(IRI optional). ";break}if(p>=6){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"",i=void 0!==e[u[4]]?"<a href='"+e[u[4]].value+"' target='_blank'>"+t+"</a>":t,s=void 0!==e[u[5]]?"<img src='"+e[u[5]].value+"' style='max-width:150px;height:150px;float:right;'/>":"";(o=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup('<div style="display: flow-root;"><b>'+i+"</b>"+s+"<br/>"+a+"</div>")}else if(5===p){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"",i=void 0!==e[u[4]]?"<a href='"+e[u[4]].value+"'>"+t+"</a>":t;(o=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+i+"</b><br/>"+a)}else if(4===p){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"";(o=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+t+"</b><br/>"+a)}else if(3===p){let t=void 0!==e[u[2]]?e[u[2]].value:"";(o=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+t+"</b>")}else 2===p&&(o=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).addTo(s);r.addLayer(o),m.push(o)}return""!==c?i(Error(c)):(s.addLayer(r),n=L.featureGroup(m),s.fitBounds(n.getBounds()),a())}})}}const Q=Object.freeze({Map:K});const V=S,Z=x,J=q,ee=X,te=Object.freeze({visualization:Q,API:G}),ae=O.VERSION,ie=O.HOMEPAGE;t.prototype.extend({selectchart:function(e,t){let a="render";return e&&("string"==typeof e?a=e:"object"==typeof e&&(a=e.action?e.action:a)),this.each(function(t,i){t>0&&"render"===a&&(e&&"object"==typeof e?b.draw(i,e):b.draw(i))})},containerchart:function(e,t){let a="render";return e&&("string"==typeof e?a=e:"object"==typeof e&&(a=e.action?e.action:a)),this.each(function(t,i){t>0&&"render"===a&&(e&&"object"==typeof e?P.drawWithElementId($(i).attr("id"),e):P.drawWithElementId($(i).attr("id")))})}}),T.detectRoot();var se=Object.freeze({sgvizler:V,bordercloud:Z,google:J,d3:ee,leaflet:te,VERSION:ae,HOMEPAGE:ie,containerLoadAll:i,containerDraw:n,containerDrawAll:r,selectDraw:o,selectDrawAll:l,getChartDoc:d,create:c});e.sgvizler=V,e.bordercloud=Z,e.google=J,e.d3=ee,e.leaflet=te,e.VERSION=ae,e.HOMEPAGE=ie,e.containerLoadAll=i,e.containerDraw=n,e.containerDrawAll=r,e.selectDraw=o,e.selectDrawAll=l,e.getChartDoc=d,e.create=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sgvizler2.min.js.map
