!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jquery")):"function"==typeof define&&define.amd?define(["exports","jquery"],t):t(e.sgvizler2={},e.jQuery)}(this,function(e,t){"use strict";function a(e,t,a,s){return new(a||(a=Promise))(function(i,n){function o(e){try{r(s.next(e))}catch(e){n(e)}}function l(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){e.done?i(e.value):new a(function(t){t(e.value)}).then(o,l)}r((s=s.apply(e,t||[])).next())})}function s(){C.loadAllDependencies()}function i(e){e&&"object"==typeof e&&(J.API.key=e.googleApiKey?e.googleApiKey:"",te.API.osmAccessToken=e.osmAccessToken?e.osmAccessToken:"")}function n(e,t){i(t),C.drawWithElementId(e)}function o(e){i(e),C.drawAll()}function l(e){E.drawWithElementId(e)}function r(){E.drawAll()}function d(e,t){return E.getChartDoc(e,t)}function c(e,t,a,s,i,n){return C.create(e,t,a,s,i,n)}var u;t.default;!function(e){e[e.EMPTY=0]="EMPTY",e[e.UNKNOWN=1]="UNKNOWN",e[e.VARIABLE=2]="VARIABLE",e[e.STYLE=3]="STYLE",e[e.CLASS=4]="CLASS"}(u||(u={}));class h{constructor(){this.options={},this._tabDependences=[],this._patternOptions=u.EMPTY,this._width="",this._height="",this._optionsRaw="",this._class="",this._style="",this._width="100%",this._isDone=!1;let e=this;T.on("loaded",()=>{null!=e.container&&!e._isDone&&e.isLoadedAllDependencies()&&null!==e._resultSparql&&e.doDraw()})}loadDependenciesAndDraw(e){return a(this,void 0,void 0,function*(){w.log("Chart loaded dependencies : "+this.container.id),this._resultSparql=e,this.isLoadedAllDependencies()?yield this.doDraw():yield this.loadDependencies()})}loadDependencies(){return a(this,void 0,void 0,function*(){let e=[];for(let t of this._tabDependences)e.push(t.load());return Promise.all(e)})}get patternOptions(){return this._patternOptions}get classHtml(){return this._class}set classHtml(e){this._class=e}get style(){return this._style}set style(e){this._style=e}get container(){return this._container}set container(e){this._container=e}get optionsRaw(){return this._optionsRaw}set optionsRaw(e){this._optionsRaw=e,this.doParseOptionsRaw()}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}getHTMLStyleOrClass(){let e="",t=this.options;return this._patternOptions===u.CLASS&&(e='class="'+(e=Object.keys(t).map(e=>"${opts[property]}").join(" "))+'"'),this._patternOptions===u.STYLE&&(e='style="'+(e=Object.keys(t).map(e=>"${property}:${opts[property]}").join(";"))+'"'),e}addScript(e,t){let a=new m(e,t);return this._tabDependences.push(a),a}addCss(e,t){let a=new f(e,t);return this._tabDependences.push(a),a}isLoadedAllDependencies(){for(let e of this._tabDependences)if(!T.isLoaded(e))return!1;return!0}doDraw(){w.log("Chart started : "+this._container.id);let e=this;null!==this._resultSparql?this.draw(this._resultSparql).then(function(t){e._isDone=!0,w.log("Chart finished : "+e._container.id)},function(t){console.log(t),w.displayFeedback(e._container,R.ERROR_CHART,[t]),w.log("Chart finished with error : "+e._container.id)}):(w.displayFeedback(e._container,R.ERROR_DATA_EMPTY),w.log("Chart finished with error : "+e._container.id))}execPattern(e,t){let a,s=this._optionsRaw;for(;null!==(a=e.exec(s));)this.options[a[1]]=a[2].trim(),this._patternOptions=t}doParseOptionsRaw(){let e=/\|? *([^=]*) *= *([^=|]*)/iy,t=/([^:]+):([^:;]+) *;?/iy,a=/([^ |;]+) ?/iy,s=this._optionsRaw;if(this._patternOptions=""===s?u.EMPTY:u.UNKNOWN,this.patternOptions===u.UNKNOWN&&this.execPattern(e,u.VARIABLE),this.patternOptions===u.UNKNOWN&&this.execPattern(t,u.STYLE),this.patternOptions===u.UNKNOWN){let e,t=this._optionsRaw,s=0;for(;null!==(e=a.exec(t));)this.options["class"+s]=e[2],this._patternOptions=u.UNKNOWN,s++}this.patternOptions===u.UNKNOWN?w.displayFeedback(this.container,R.ERROR_CHART_PATTERN_OPTION_UNKNOWN,[this._optionsRaw]):this.patternOptions!==u.VARIABLE&&this.patternOptions!==u.STYLE||(void 0!==this.options.width&&(this.width=this.options.width),void 0!==this.options.height&&(this.height=this.options.height))}}class p extends h{get icon(){return"fa-table"}get label(){return"Table"}get subtext(){return"simple table"}get classFullName(){return"sgvizler.visualization.Table"}get tutorialFilename(){return"tutorial-sgvizler_visualization_Table.html"}constructor(){super()}draw(e){let t=this;return new Promise(function(a,s){let i=Object.assign({headings:"true"},t.options),n=e.head.vars,o=e.results.bindings,l=(n.length,o.length,"<table "+t.getHTMLStyleOrClass()+" >");if("true"===i.headings){l+="<tr>";for(let e of n)l+="<th>"+e+"</th>";l+="</tr>"}for(let e of o){l+="<tr>";for(let t of n)l+="<td>"+e[t].value+"</td>";l+="</tr>"}l+="</table>";let r=document.getElementById(t.container.id);r&&(r.innerHTML=l),a()})}}var g=Object.freeze({Table:p});class T{static on(e,t){"loaded"===e&&T._listCallEvent.push(t)}static detectRoot(){let e=document.evaluate('//script[contains(@src,"sgvizler2.js")]/@src',document,null,XPathResult.STRING_TYPE,null).stringValue,t=/^(.*)sgvizler2\.js$/.exec(e);t&&(T._pathScripts=t[1])}static isLoad(e){return-1!==T._load.indexOf(e.url)}static isLoaded(e){return-1!==T._loaded.indexOf(e.url)}static load(e){e instanceof m?T.loadScript(e):e instanceof f&&T.loadCss(e)}static fireEvent(e){for(let t of T._listCallEvent)t(e)}static checkDependenciesToLoad(){let e=T._dependenciesToLoad.length;for(let t=0;t<e;t++){let e=T._dependenciesToLoad[t];void 0===e||T.isLoaded(e)?this._dependenciesToLoad.splice(t):e instanceof m?T.loadScript(e):e instanceof m&&T.loadCss(e)}}static getAbsoluteURL(e){return e.match(/^(\/\/|https?)/)?e:T._pathScripts+e}static loadScript(e){let t=e.url;return new Promise(function(a,s){if(e.loadBefore&&!e.loadBefore.endDownload)return w.log("Waiting : "+e.loadBefore.url+" before "+e.url),T._dependenciesToLoad.push(e),T.load(e.loadBefore);if(T.isLoad(e))return;T._load.push(t),w.log("Loading : "+e.url);let i=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=T.getAbsoluteURL(t),n.onload=function(){T._loaded.push(t),e.callBack(),T.checkDependenciesToLoad(),T.fireEvent("loaded")},i.appendChild(n)})}static loadCss(e){let t=e.url;return new Promise(function(a,s){if(e.loadBefore&&!e.loadBefore.endDownload)return T._dependenciesToLoad.push(e),T.load(e.loadBefore);if(T.isLoad(e))return;T._load.push(t);let i=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.href=T.getAbsoluteURL(t),n.onload=function(){T._loaded.push(t),w.log("Loaded : "+t),e.callBack(),T.checkDependenciesToLoad(),T.fireEvent("loaded")},i.appendChild(n)})}}T._load=[],T._loaded=[],T._dependenciesToLoad=[],T._pathScripts="",T._listCallEvent=[];class _{constructor(e,t){this.url=e,this.loadBefore=t||null,this.endDownload=!1,this.startDownload=!1}load(){this.isLoaded()||(this.startDownload=!0,w.log("Load started :"+this.url),T.load(this))}isLoaded(){return T.isLoaded(this)&&(this.startDownload=!0,this.endDownload=!0),this.endDownload}callBack(){this.endDownload=!0,w.log("Load ended :"+this.url)}}class m extends _{}class f extends _{}class b{static getErrorMessage(e){let t=/MalformedQueryException: *(.*)/m.exec(e.response);return null!==t?t[1]:e.response}}class E{static drawWithElementId(e){return a(this,void 0,void 0,function*(){let t=document.getElementById(e);t&&(yield E.draw(t))})}static draw(e,t){return a(this,void 0,void 0,function*(){let a=E.getSelectOptions(t);for(let t of a)e.appendChild(t.cloneNode(!0))})}static drawAll(){let e=E.getSelectOptions(),t=document.evaluate("//select[contains(@class, '"+E.CLASS_NAME+"')]",document,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(let a=0;a<t.snapshotLength;a++)for(let s of e)t.snapshotItem(a).appendChild(s.cloneNode(!0))}static getChartDoc(e,t){let a=v.getObjectByPath(e),s="";return(s=void 0!==t?t:O.DOCPATH)+a.tutorialFilename}static getSelectOptions(e){let t,a,s,i,n,o,l,r,d=[],c=e&&e.selected?e.selected:this.classOfChartSelectedByDefault;for(let u of this.charts){s=document.createElement("optgroup"),(i=document.createAttribute("label")).value=u.label,s.setAttributeNode(i);for(let i of u.charts)t=v.getObjectByPath(i),a=document.createElement("option"),(o=document.createAttribute("data-icon")).value=t.icon,l=document.createAttribute("data-subtext"),"classFullName"===e.subtext?l.value=t.classFullName:l.value=t.subtext,(n=document.createAttribute("value")).value=t.classFullName,c===i&&(r=document.createAttribute("selected"),a.setAttributeNode(r)),a.text=t.label,a.setAttributeNode(o),a.setAttributeNode(l),a.setAttributeNode(n),s.appendChild(a);d.push(s)}return d}}E.CLASS_NAME="sgvizler-select",E.classOfChartSelectedByDefault="bordercloud.visualization.DataTable",E.charts=[{label:"bordercloud.visualization",charts:["bordercloud.visualization.DataTable"]},{label:"d3.visualization",charts:["d3.visualization.Pie"]},{label:"leaflet.visualization",charts:["leaflet.visualization.Map"]},{label:"google.visualization",charts:["google.visualization.Table","google.visualization.Map"]},{label:"sgvizler.visualization",charts:["sgvizler.visualization.Table"]}];var R;!function(e){e[e.ERROR_CHART_UNKNOWN=0]="ERROR_CHART_UNKNOWN",e[e.ERROR_CHART_PATTERN_OPTION_UNKNOWN=1]="ERROR_CHART_PATTERN_OPTION_UNKNOWN",e[e.ERROR_REQUEST=2]="ERROR_REQUEST",e[e.ERROR_CHART=3]="ERROR_CHART",e[e.ERROR_DEPENDENCIES=4]="ERROR_DEPENDENCIES",e[e.ERROR_ENDPOINT_FORGOT=5]="ERROR_ENDPOINT_FORGOT",e[e.ERROR_DATA_EMPTY=6]="ERROR_DATA_EMPTY"}(R||(R={}));class A{static get(e,t){let a="";switch(e){case R.ERROR_CHART_UNKNOWN:a="The chart $0 does not exist.";break;case R.ERROR_CHART_PATTERN_OPTION_UNKNOWN:a="The pattern of chart options is unknown : '$0'Use 'variable1=value1|variable1=value1' or for style 'width:100%;font:red;' or 'class1 class2'";break;case R.ERROR_REQUEST:a="Sorry, the sparql server sent an error. </br> $0";break;case R.ERROR_CHART:a="Sorry, the chart sent an error. </br> $0";break;case R.ERROR_DEPENDENCIES:a="The chart dependencies sent an error. </br> $0";break;case R.ERROR_ENDPOINT_FORGOT:a="The endpoint of Sparql service is forgotten (data-sgvizler-endpoint).";break;case R.ERROR_DATA_EMPTY:a="The resquest sent null."}if(t)for(let e=0,s=t.length;e<s;e++)a=a.replace("$"+e,t[e]);return a}}class v{static getObjectByPath(e,t){let a,s,i=e.split("."),n=t||ie;for(a=0,s=i.length;a<s&&void 0!==n;a+=1)if(a<s-1)n=n[i[a]];else try{n=new n[i[a]]}catch(e){n=void 0}return void 0!==n||t||(n=this.getObjectByPath(e,window)),n}static escapeHtml(e){let t=document.createTextNode(e),a=document.createElement("div");return a.appendChild(t),a.innerHTML}static decodeHtml(e){let t=document.createElement("div");return t.innerHTML=e,t.textContent}}class w{static log(e){console.log(this.elapsedTime()+"s: "+e)}static displayFeedback(e,t,a){let s=A.get(t,a);if(2===e.loglevel&&s){let t=document.getElementById(e.id);t&&(t.innerHTML="<p style='color:red'>"+s+"</p>")}}static elapsedTime(){return(Date.now()-this._startTime)/1e3}}w._startTime=Date.now();class O{}O.VERSION="0.0",O.HOMEPAGE="https://bordercloud.github.io/sgvizler2/index.html",O.DOCPATH="https://bordercloud.github.io/sgvizler2/";var N;!function(e){e[e.xml=0]="xml",e[e.json=1]="json",e[e.jsonp=2]="jsonp"}(N||(N={}));class D{static getOutputLabel(e){let t="";switch(e){case N.xml:t="xml";break;case N.json:t="json";break;case N.jsonp:t="jsonp"}return t}static getXMLHttpRequestResponseType(e){let t="";switch(e){case N.xml:t="";break;case N.json:case N.jsonp:t="json"}return t}static getHeaderAccept(e){let t="";switch(e){case N.xml:t="application/sparql-results+xml";break;case N.json:case N.jsonp:t="application/sparql-results+json"}return t}static convertString(e){let t=N.json;switch(e){case"xml":t=N.xml;break;case"json":t=N.json;break;case"jsonp":t=N.jsonp}return t}}class y{constructor(){this._query="",this._endpoint="",this._endpointOutputFormat=N.json,this._method="GET",this.listeners={}}get method(){return this._method}set method(e){this._method=e}get container(){return this._container}set container(e){this._container=e}get query(){return this._query}set query(e){this._query=e}get endpoint(){return this._endpoint}set endpoint(e){this._endpoint=e}get endpointOutputFormat(){return this._endpointOutputFormat}set endpointOutputFormat(e){this._endpointOutputFormat=e}sendRequest(){let e=this;return new Promise(function(t,a){let s,i=new XMLHttpRequest,n=e.endpoint;"get"===e.method.toLowerCase()?n+="?query="+encodeURIComponent(e.query)+"&output="+D.getOutputLabel(e.endpointOutputFormat):s={query:e.query,output:D.getOutputLabel(e.endpointOutputFormat)},i.open(e.method,n,!0),i.setRequestHeader("Accept",D.getHeaderAccept(e.endpointOutputFormat)),i.onprogress=function(e){if(e.lengthComputable){let t=e.loaded/e.total*100;console.log("onprogress"+t)}},i.onload=function(e){i.readyState===XMLHttpRequest.DONE&&(200===i.status?t(JSON.parse(i.response)):a(b.getErrorMessage(i)))},i.onerror=function(e){a(b.getErrorMessage(i))},i.onabort=function(){a(b.getErrorMessage(i))},s?i.send(s):i.send()})}}var I;!function(e){e[e.FAILED=0]="FAILED",e[e.LOADED=1]="LOADED",e[e.LOADING=2]="LOADING"}(I||(I={}));class C{constructor(e){this._chartOptions="",this._chartName="",this._loglevel=0,this._id="";let t=document.getElementById(e);if(null===t)throw new Error("elementID unknown : "+e);let a=C;this._state=I.LOADING;let s=t.attributes;s[a.LOG_LEVEL_ATTRIBUTE_NAME]&&(this._loglevel=parseInt(s[a.LOG_LEVEL_ATTRIBUTE_NAME].value,10)),s[a.CHART_ATTRIBUTE_NAME]&&(this._chartName=s[a.CHART_ATTRIBUTE_NAME].value),s[a.CHART_OPTION_ATTRIBUTE_NAME]&&(this._chartOptions=s[a.CHART_OPTION_ATTRIBUTE_NAME].value);let i=new y;if(i.container=this,this._id=e,s[a.QUERY_ATTRIBUTE_NAME]&&(i.query=s[a.QUERY_ATTRIBUTE_NAME].value),!s[a.ENDPOINT_ATTRIBUTE_NAME])return this._state=I.FAILED,void w.displayFeedback(this,R.ERROR_ENDPOINT_FORGOT);i.endpoint=s[a.ENDPOINT_ATTRIBUTE_NAME].value,s[a.OUTPUT_FORMAT_ATTRIBUTE_NAME]&&(i.endpointOutputFormat=D.convertString(s[a.OUTPUT_FORMAT_ATTRIBUTE_NAME].value)),s[a.OUTPUT_METHOD_ATTRIBUTE_NAME]&&(i.method=s[a.OUTPUT_METHOD_ATTRIBUTE_NAME].value),this._request=i;let n=v.getObjectByPath(this.chartName);if(void 0===n)this._state=I.FAILED,w.displayFeedback(this,R.ERROR_CHART_UNKNOWN,[this.chartName]);else{n.container=this;try{let t=$("#"+e),a=t.css("width"),s=t.css("height");null!==a&&(n.width=a),null!==s&&"0px"!==s&&(n.height=s)}catch(e){}n.optionsRaw=this._chartOptions,this._chart=n}}static drawWithElementId(e,t){return a(this,void 0,void 0,function*(){let t=new C(e);w.log("drawing id: "+e),yield t.draw()})}static drawAll(){let e=[],t=[],a=document.evaluate("//div[@"+C.PREFIX+"query]/@id",document,null,XPathResult.ANY_TYPE,null),s=a.iterateNext();for(;s;)t.push(s.value),s=a.iterateNext();for(let a of t)e.push(C.drawWithElementId(a));return Promise.all(e)}static loadDependenciesId(e,t){return a(this,void 0,void 0,function*(){let t=new C(e);w.log("Load dependencies id: "+e),yield t.loadDependencies()})}static loadAllDependencies(){let e=[],t=[],a=document.evaluate("//div[@"+C.PREFIX+"query]/@id",document,null,XPathResult.ANY_TYPE,null),s=a.iterateNext();for(;s;)t.push(s.value),s=a.iterateNext();for(let a of t)e.push(C.loadDependenciesId(a));return Promise.all(e)}static create(e,t,a,s,i,n){let o=document.getElementById(e);if(null===o)throw new Error("elementID unknown : "+e);let l=C,r=document.createAttribute(l.QUERY_ATTRIBUTE_NAME),d=document.createAttribute(l.ENDPOINT_ATTRIBUTE_NAME),c=document.createAttribute(l.CHART_ATTRIBUTE_NAME);if(r.value=a,d.value=t,c.value=s,o.setAttributeNode(r),o.setAttributeNode(d),o.setAttributeNode(c),i){let e=document.createAttribute(l.CHART_OPTION_ATTRIBUTE_NAME);e.value=i,o.setAttributeNode(e)}if(n){let e=document.createAttribute(l.LOG_LEVEL_ATTRIBUTE_NAME);e.value=n,o.setAttributeNode(e)}return o.innerHTML}get id(){return this._id}get chartName(){return this._chartName}get chartOptions(){return this._chartOptions}get chart(){return this._chart}get request(){return this._request}get loglevel(){return this._loglevel}draw(){return a(this,void 0,void 0,function*(){let e;if(this._state!==I.FAILED){try{e=yield this.request.sendRequest()}catch(e){console.log(e),w.displayFeedback(this,R.ERROR_REQUEST,[e]),this._state=I.FAILED}if(this._state!==I.FAILED)try{this._chart.loadDependenciesAndDraw(e)}catch(e){console.log(e),w.displayFeedback(this,R.ERROR_CHART,[e]),this._state=I.FAILED}}})}loadDependencies(){return a(this,void 0,void 0,function*(){try{yield this._chart.loadDependencies()}catch(e){console.log(e),w.displayFeedback(this,R.ERROR_DEPENDENCIES,[e]),this._state=I.FAILED}})}}C.PREFIX="data-sgvizler-",C.QUERY_ATTRIBUTE_NAME=C.PREFIX+"query",C.ENDPOINT_ATTRIBUTE_NAME=C.PREFIX+"endpoint",C.OUTPUT_FORMAT_ATTRIBUTE_NAME=C.PREFIX+"endpoint-output-format",C.OUTPUT_METHOD_ATTRIBUTE_NAME=C.PREFIX+"endpoint-method",C.CHART_ATTRIBUTE_NAME=C.PREFIX+"chart",C.CHART_OPTION_ATTRIBUTE_NAME=C.PREFIX+"chart-options",C.LOG_LEVEL_ATTRIBUTE_NAME=C.PREFIX+"log";const P=g;var S,M=Object.freeze({visualization:P,Loader:T,Dependency:_,ScriptDependency:m,CssDependency:f,SparqlError:b,Select:E,get MESSAGES(){return R},Messages:A,Tools:v,Logger:w,Core:O,get CHART_PATTERN_OPTIONS(){return u},Chart:h,get SPARQL_RESULT(){return N},SparqlTools:D,Request:y,get CONTAINER_STATE(){return I},Container:C});!function(e){e[e.TAG=0]="TAG",e[e.STYLE=1]="STYLE"}(S||(S={}));class F extends h{constructor(){super(),this.addCss("lib/DataTables/datatables.min.css"),this.addCss("lib/DataTables/DataTables-1.10.15/css/dataTables.bootstrap4.min.css");let e=this.addScript("lib/DataTables/datatables.min.js");this.addScript("lib/DataTables/DataTables-1.10.15/js/dataTables.bootstrap4.js",e),this.addScript("lib/DataTables/Buttons-1.4.0/js/dataTables.buttons.js",e)}static buildColumnDefs(e,t){let a,s,i,n=/ *col([1-9]+)\_([a-zA-Z]+)\_([^=;\n]*) */gi,o=[],l=[];for(let e=0;e<t;e++)l[e]=[],l[e][S.TAG]="",l[e][S.STYLE]="";for(;null!==(a=n.exec(e));)a.index===n.lastIndex&&n.lastIndex++,l[i=parseInt(a[1],10)-1][S.TAG]=a[2],l[i][S.STYLE]+=a[3]+";";for(let e=0;e<t;e++){switch(l[e][S.TAG]){case"img":s=this.getFunctionColumnDefImg(l[e][S.STYLE]);break;case"span":s=this.getFunctionColumnDefSpan(l[e][S.STYLE]);break;default:s=this.getFunctionColumnDefDefault()}o[e]={targets:e,render:s}}return o}static getFunctionColumnDefDefault(){return function(e,t,a,s){return e}}static getFunctionColumnDefImg(e){return function(t,a,s,i){return'<img src="'+t+'"  style="'+e+'">'}}static getFunctionColumnDefSpan(e){return function(t,a,s,i){return'<span style="'+e+'">'+t+"</span>"}}get icon(){return"fa-table"}get label(){return"DataTable"}get subtext(){return"DataTable"}get classFullName(){return"bordercloud.visualization.DataTable"}get tutorialFilename(){return"tutorial-bordercloud_visualization_DataTable.html"}draw(e){let t=this;return new Promise(function(a,s){let i=document.getElementById(t.container.id);if(i){try{let a,n,o,l=e.head.vars,r=e.results.bindings,d=l.length,c=r.length,u=t.container.id+"-datatable",h=[],p=[],g=document.createElement("table"),T=document.createAttribute("id"),_=document.createAttribute("class"),m=document.createAttribute("cellspacing"),f=document.createAttribute("width"),b=Object.assign({class:"table table-striped table-bordered",cellspacing:"0",width:"100%",colstyle:void 0},t.options);for(let e=0;e<d;e++)h[e]={title:l[e]};void 0!==b.colstyle&&(o=F.buildColumnDefs(b.colstyle,d));for(let e=0;e<c;e++){a=r[e],n=[];for(let e=0;e<d;e+=1)n[e]=void 0!==a[l[e]]?a[l[e]].value:"";p[e]=n}T.value=u,_.value=b.class,m.value=b.cellspacing,f.value=b.width,g.setAttributeNode(T),g.setAttributeNode(_),g.setAttributeNode(m),g.setAttributeNode(f),i.appendChild(g),$("#"+u).DataTable({data:p,columns:h,columnDefs:o,dom:"Bfrtip",buttons:["csv","pdf","print"]})}catch(e){s(e)}a()}else w.displayFeedback(t.container,R.ERROR_CHART_UNKNOWN,[t.container.id])})}}const x=Object.freeze({DataTable:F});var k=Object.freeze({visualization:x});class j{constructor(e){let t=new google.visualization.DataTable,a=e.head.vars,s=e.results.bindings,i=a.length,n=s.length;for(let e of a)if(n>0){let a=s[0][e].datatype;"http://www.w3.org/2001/XMLSchema#decimal"===a||"http://www.w3.org/2001/XMLSchema#integer"===a?t.addColumn("number",e):"http://www.w3.org/2001/XMLSchema#boolean"===a?t.addColumn("boolean",e):"http://www.w3.org/2001/XMLSchema#date"===a?t.addColumn("date",e):"http://www.w3.org/2001/XMLSchema#dateTime"===a?t.addColumn("datetime",e):"http://www.w3.org/2001/XMLSchema#time"===a?t.addColumn("timeofday",e):t.addColumn("string",e)}else t.addColumn("string",e);t.addRows(n);for(let e=0;e<n;e++)for(let n=0;n<i;n++){t.setCell(e,n,s[e][a[n]].value);let i=s[0][a[n]].datatype;if("http://www.w3.org/2001/XMLSchema#decimal"===i)t.setCell(e,n,parseFloat(s[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#integer"===i)t.setCell(e,n,parseInt(s[e][a[n]].value,10));else if("http://www.w3.org/2001/XMLSchema#boolean"===i)t.setCell(e,n,"true"===s[e][a[n]].value);else if("http://www.w3.org/2001/XMLSchema#date"===i)t.setCell(e,n,Date.parse(s[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#dateTime"===i)t.setCell(e,n,Date.parse(s[e][a[n]].value));else if("http://www.w3.org/2001/XMLSchema#time"===i){let i=Date.parse(s[e][a[n]].value);t.setCell(e,n,[i.getHours(),i.getHours(),i.getSeconds(),i.getMilliseconds()])}else t.setCell(e,n,s[e][a[n]].value)}this._dataTable=t}getDataTable(){return this._dataTable}}class U extends h{constructor(){super();this.addScript("https://www.gstatic.com/charts/loader.js")}static init(){google.charts.load("current",{packages:["table"]}),U._isInit=!0}get icon(){return"fa-table"}get label(){return"Table"}get subtext(){return"Table"}get classFullName(){return"google.visualization.Table"}get tutorialFilename(){return"tutorial-google_visualization_Table.html"}draw(e){let t=this;return new Promise(function(a,s){let i="100%";""!==t.height&&(i=t.height);Object.assign({showRowNumber:!1,width:t.width,height:i},t.options);U._isInit||U.init(),google.charts.setOnLoadCallback(()=>{let a=new j(e);new google.visualization.Table(document.getElementById(t.container.id)).draw(a.getDataTable(),t.options)}),a()})}}U._isInit=!1;class B{static get key(){return this._key}static set key(e){this._key=e}}B._key="";class z extends h{constructor(){super();this.addScript("https://www.gstatic.com/charts/loader.js")}static init(){google.charts.load("current",{packages:["map"],mapsApiKey:B.key}),z._isInit=!0}get icon(){return"fa-map"}get label(){return"Map"}get subtext(){return"Map"}get classFullName(){return"google.visualization.Map"}get tutorialFilename(){return"tutorial-google_visualization_Map.html"}draw(e){let t=this;return new Promise(function(a,s){let i="100%";""!==t.height&&(i=t.height);let n=Object.assign({width:t.width,height:i,showTooltip:!0,showInfoWindow:!0},t.options);location.origin.startsWith("file:")&&(n=Object.assign({icons:{default:{normal:"https://maps.google.com/mapfiles/ms/micons/red-dot.png",selected:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"}}},n)),z._isInit||z.init(),google.charts.setOnLoadCallback(()=>{let a=new j(e);new google.visualization.Map(document.getElementById(t.container.id)).draw(a.getDataTable(),n)}),a()})}}z._isInit=!1;const H=Object.freeze({Data:j,Table:U,Map:z});var q=Object.freeze({visualization:H,API:B});class W extends h{get icon(){return"fa-pie-chart"}get label(){return"Pie"}get subtext(){return"Pie"}get classFullName(){return"d3.visualization.Pie"}get tutorialFilename(){return"tutorial-d3_visualization_Pie.html"}constructor(){super(),this.addCss("lib/d3/d3.css");this.addScript("lib/d3/d3.js")}draw(e){let t=this;return new Promise(function(a,s){let i="100%";""!==t.height&&(i=t.height);Object.assign({showRowNumber:!1,width:t.width,height:i},t.options);let n,o,l=e.head.vars,r=e.results.bindings,d=(l.length,r.length,[]);for(let e of r)n=e[l[0]].value,o=Number(e[l[1]].value),void 0===n||void 0===o?w.log("Erreur ? D3JS:pie label "+n+" count "+o):d.push({label:n,count:o});let c=d3.select("#"+t.container.id),u=c.node();if(u){let e=0!==u.clientWidth?u.clientWidth:300,t=0!==u.clientHeight?u.clientHeight:150,a=c.append("svg").attr("width",e).attr("height",t).attr("id","idtest"),s=Math.min(e,t)/2;a=a.append("g").attr("transform","translate("+e/2+","+t/2+")");let i=d3.scaleOrdinal(d3.schemeCategory10),n=d3.arc().innerRadius(0).outerRadius(s),o=d3.pie().value(function(e){return e.count}).sort(null),l=(a.selectAll("path").data(o(d)).enter().append("path").attr("d",n).attr("fill",function(e,t){return i(e.data.label)}),a.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){let a=22*i.domain().length/2;return"translate("+(2*s-36+20)+","+(22*t-a)+")"}));l.append("rect").attr("width",18).attr("height",18).style("fill",i).style("stroke",i),l.append("text").attr("x",22).attr("y",14).text(function(e){return e})}a()})}}const Y=Object.freeze({Pie:W});var X=Object.freeze({visualization:Y});class G{static get osmAccessToken(){return this._osmAccessToken}static set osmAccessToken(e){this._osmAccessToken=e}}G._osmAccessToken="";class K extends h{get icon(){return"fa-map"}get label(){return"Map"}get subtext(){return"Map"}get classFullName(){return"leaflet.visualization.Map"}get tutorialFilename(){return"tutorial-leaflet_visualization_Map.html"}constructor(){super(),this.addCss("lib/leaflet/leaflet.css"),this.addCss("lib/leaflet/MarkerCluster.Default.css");let e=this.addScript("lib/leaflet/leaflet-src.js");this.addScript("lib/leaflet/leaflet.markercluster-src.js",e)}draw(e){let t=this;return new Promise(function(a,s){let i,n,o,l,r,d,c="",u=e.head.vars,h=e.results.bindings,p=u.length,g=(h.length,"180px"),T=t.container.id+"-leaflet",_=document.getElementById(t.container.id),m=[];""!==t.height&&(g=t.height);let f=Object.assign({width:t.width,height:g,showTooltip:!0,showInfoWindow:!0},t.options);if(_){_.innerHTML="<div id='"+T+"' style='width: "+f.width+"; height: "+f.height+";'></div>";let e=new L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:G.osmAccessToken});if(i=L.map(T,{zoom:13,layers:[e]}),o=L.markerClusterGroup({chunkedLoading:!0,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0}),p<=2)c="Parameters : latitude(xsd:Decimal) longitude(xsd:Decimal) title(xsd:string optional) introduction(xsd:string optional) link(IRI optional)";else for(let e of h){if(r=parseFloat(e[u[0]].value),d=parseFloat(e[u[1]].value),isNaN(r)||isNaN(d)){c="Latitude or longitude is not a decimal. Parameters of chart : latitude(xsd:Decimal) longitude(xsd:Decimal) title(xsd:string optional) introduction(xsd:string optional) link(IRI optional). ";break}if(p>=6){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"",s=void 0!==e[u[4]]?"<a href='"+e[u[4]].value+"' target='_blank'>"+t+"</a>":t,i=void 0!==e[u[5]]?"<img src='"+e[u[5]].value+"' style='max-width:150px;height:150px;float:right;'/>":"";(l=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup('<div style="display: flow-root;"><b>'+s+"</b>"+i+"<br/>"+a+"</div>")}else if(5===p){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"",s=void 0!==e[u[4]]?"<a href='"+e[u[4]].value+"'>"+t+"</a>":t;(l=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+s+"</b><br/>"+a)}else if(4===p){let t=void 0!==e[u[2]]?e[u[2]].value:"",a=void 0!==e[u[3]]?e[u[3]].value:"";(l=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+t+"</b><br/>"+a)}else if(3===p){let t=void 0!==e[u[2]]?e[u[2]].value:"";(l=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).bindPopup("<b>"+t+"</b>")}else 2===p&&(l=L.marker([parseFloat(e[u[0]].value),parseFloat(e[u[1]].value)])).addTo(i);o.addLayer(l),m.push(l)}""!==c&&s(Error(c)),i.addLayer(o),n=L.featureGroup(m),i.fitBounds(n.getBounds()),a()}})}}const V=Object.freeze({Map:K}),Q=M,Z=k,J=q,ee=X,te=Object.freeze({visualization:V,API:G}),ae=O.VERSION,se=O.HOMEPAGE;t.prototype.extend({selectchart:function(e,t){let a=this,s="render";return e&&("string"==typeof e?s=e:"object"==typeof e&&(s=e.action?e.action:s)),a.each(function(t,a){t>0&&"render"===s&&(e&&"object"==typeof e?E.draw(a,e):E.draw(a))})},containerchart:function(e,t){let a=this,s="render";return e&&("string"==typeof e?s=e:"object"==typeof e&&(s=e.action?e.action:s)),a.each(function(t,a){t>0&&"render"===s&&(e&&"object"==typeof e?C.drawWithElementId($(a).attr("id"),e):C.drawWithElementId($(a).attr("id")))})}}),T.detectRoot();var ie=Object.freeze({sgvizler:Q,bordercloud:Z,google:J,d3:ee,leaflet:te,VERSION:ae,HOMEPAGE:se,containerLoadAll:s,containerDraw:n,containerDrawAll:o,selectDraw:l,selectDrawAll:r,getChartDoc:d,create:c});e.sgvizler=Q,e.bordercloud=Z,e.google=J,e.d3=ee,e.leaflet=te,e.VERSION=ae,e.HOMEPAGE=se,e.containerLoadAll=s,e.containerDraw=n,e.containerDrawAll=o,e.selectDraw=l,e.selectDrawAll=r,e.getChartDoc=d,e.create=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sgvizler2.min.js.map
